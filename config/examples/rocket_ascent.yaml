# Icarus Simulation Configuration
# Example: Rocket Ascent with 6DOF Dynamics (Vehicle6DOF)
#
# This example demonstrates a single-stage rocket ascent with:
# - Mass depletion (FuelTank component)
# - Throttleable engine (RocketEngine component)
# - Full 6DOF rigid body dynamics with integrated mass/force aggregation
#
# Uses Vehicle6DOF unified component which combines:
# - MassAggregator (mass property aggregation)
# - ForceAggregator (force/moment aggregation with ECEF→body transform)
# - RigidBody6DOF (13-state quaternion dynamics)
#
# This eliminates ~20 signal routes compared to the separate component approach.

simulation:
  name: "Rocket Ascent Example"
  description: "Single-stage rocket using Vehicle6DOF unified component"

time:
  start: 0.0
  end: 120.0
  dt: 0.01

integrator:
  type: RK4

# =============================================================================
# Components
# =============================================================================
components:
  # ---------------------------------------------------------------------------
  # Mass Sources
  # ---------------------------------------------------------------------------

  # Dry structure (constant mass)
  - type: StaticMass
    name: Structure
    entity: Rocket
    scalars:
      mass: 500.0
      inertia_xx: 50.0
      inertia_yy: 100.0
      inertia_zz: 100.0
    vectors:
      cg: [2.0, 0, 0]

  # Propellant tank (depleting mass)
  - type: FuelTank
    name: FuelTank
    entity: Rocket
    scalars:
      initial_fuel_mass: 1000.0
      dry_mass: 50.0
      tank_radius: 0.5
      tank_length: 2.0
    vectors:
      tank_cg: [1.0, 0, 0]

  # ---------------------------------------------------------------------------
  # Force Sources
  # ---------------------------------------------------------------------------

  # Gravity (point mass model)
  - type: PointMassGravity
    name: Gravity
    entity: Rocket
    scalars:
      mu: 3.986004418e14    # Earth GM [m^3/s^2]
      model: 1              # 1 = PointMass model

  # Rocket engine
  - type: RocketEngine
    name: Engine
    entity: Rocket
    scalars:
      max_thrust: 50000.0   # 50 kN
      isp_vacuum: 311.0     # Merlin-1D like
    vectors:
      thrust_direction: [1, 0, 0]    # +X body (nose direction)
      nozzle_position: [0, 0, 0]

  # ---------------------------------------------------------------------------
  # Unified 6DOF Dynamics (replaces MassAggregator + ForceAggregator + RigidBody6DOF)
  # ---------------------------------------------------------------------------

  - type: Vehicle6DOF
    name: Vehicle
    entity: Rocket
    # Mass sources (replaces MassAggregator)
    sources: [Structure, FuelTank]
    # Force sources by frame (replaces ForceAggregator)
    body_sources: [Engine]      # Forces in body frame
    ecef_sources: [Gravity]     # Forces in ECEF frame (transformed to body)
    # Initial conditions (same as RigidBody6DOF)
    strings:
      position_init_mode: lla           # "lla" or "ecef"
      attitude_init_mode: euler_zyx     # "euler_zyx" or "quaternion"
      reference_frame: ecef             # "eci" (inertial) or "ecef" (with Coriolis/centrifugal)
    vectors:
      initial_lla: [0.0, 0.0, 0.0]     # [lat_deg, lon_deg, alt_m]
      initial_velocity_body: [0, 0, 0]      # Starting from rest
      initial_euler_zyx: [0.0, 90.0, 0.0]   # [yaw, pitch, roll] deg - 90 pitch = vertical
      initial_omega_body: [0, 0, 0]         # No initial rotation

# =============================================================================
# Signal Routing (dramatically simplified with Vehicle6DOF)
# =============================================================================
routes:
  # --- Engine inputs ---
  # Engine mass flow → FuelTank
  - input: Rocket.FuelTank.mass_flow_rate
    output: Rocket.Engine.mass_flow_rate

  # --- Gravity inputs ---
  # Position from Vehicle
  - input: Rocket.Gravity.position.x
    output: Rocket.Vehicle.position.x
  - input: Rocket.Gravity.position.y
    output: Rocket.Vehicle.position.y
  - input: Rocket.Gravity.position.z
    output: Rocket.Vehicle.position.z
  # Mass from Vehicle
  - input: Rocket.Gravity.mass
    output: Rocket.Vehicle.total_mass

# NOTE: The following routes are NO LONGER NEEDED with Vehicle6DOF:
# - Mass→EOM routes (7 routes: total_mass, inertia.xx/yy/zz/xy/xz/yz)
# - Forces→EOM routes (6 routes: total_force.x/y/z, total_moment.x/y/z)
# - Mass→Forces routes (3 routes: cg.x/y/z)
# - EOM→Forces routes (4 routes: attitude.w/x/y/z)
# Total eliminated: 20 routes!

# =============================================================================
# Scheduler
# =============================================================================
scheduler:
  topology:
    mode: automatic
    log_order: true
    cycle_detection: warn
  groups:
    - name: mass
      rate_hz: 100.0
      priority: 1
      members:
        - component: Structure
          priority: 1
        - component: FuelTank
          priority: 2
    - name: forces
      rate_hz: 100.0
      priority: 2
      members:
        - component: Gravity
          priority: 1
        - component: Engine
          priority: 2
    - name: dynamics
      rate_hz: 100.0
      priority: 3
      members:
        - component: Vehicle
          priority: 1

# =============================================================================
# Recording (HDF5 telemetry)
# =============================================================================
recording:
  enabled: false  # Disabled for standalone testing (enable for telemetry capture)
  file: "rocket_ascent.h5"
  decimation: 10
  signals:
    - Rocket.Vehicle.position.x
    - Rocket.Vehicle.position.y
    - Rocket.Vehicle.position.z
    - Rocket.Vehicle.velocity_body.x
    - Rocket.Vehicle.velocity_body.y
    - Rocket.Vehicle.velocity_body.z
    - Rocket.Engine.thrust
    - Rocket.Engine.mass_flow_rate
    - Rocket.FuelTank.fuel_mass
    - Rocket.Vehicle.total_mass

# =============================================================================
# Logging
# =============================================================================
logging:
  console_level: info
  file_level: debug
  progress:
    enabled: true
    interval: 10.0
