# Icarus Simulation Configuration
# Example: Rocket Ascent with 6DOF Dynamics
#
# This example demonstrates a single-stage rocket ascent with:
# - Mass depletion (FuelTank component)
# - Throttleable engine (RocketEngine component)
# - Full 6DOF rigid body dynamics
# - Force/mass aggregation
#
# Designed for Hermes integration - exports key signals to shared memory.

simulation:
  name: "Rocket Ascent Example"
  description: "Single-stage rocket for Hermes integration"

time:
  start: 0.0
  end: 120.0
  dt: 0.01

integrator:
  type: RK4

# =============================================================================
# Components
# =============================================================================
components:
  # ---------------------------------------------------------------------------
  # Mass Sources
  # ---------------------------------------------------------------------------

  # Dry structure (constant mass)
  - type: StaticMass
    name: Structure
    entity: Rocket
    scalars:
      mass: 500.0
      inertia_xx: 100.0
      inertia_yy: 100.0
      inertia_zz: 50.0
    vectors:
      cg: [0, 0, 2.0]

  # Propellant tank (depleting mass)
  - type: FuelTank
    name: FuelTank
    entity: Rocket
    scalars:
      initial_fuel_mass: 1000.0
      dry_mass: 50.0
      tank_radius: 0.5
      tank_length: 2.0
    vectors:
      tank_cg: [0, 0, 1.0]

  # ---------------------------------------------------------------------------
  # Mass Aggregator
  # ---------------------------------------------------------------------------

  - type: MassAggregator
    name: Mass
    entity: Rocket
    sources: [Structure, FuelTank]

  # ---------------------------------------------------------------------------
  # Force Sources
  # ---------------------------------------------------------------------------

  # Gravity (point mass model)
  - type: PointMassGravity
    name: Gravity
    entity: Rocket
    scalars:
      mu: 3.986004418e14    # Earth GM [m^3/s^2]
      model: 1              # 1 = PointMass model

  # Rocket engine
  - type: RocketEngine
    name: Engine
    entity: Rocket
    scalars:
      max_thrust: 50000.0   # 50 kN
      isp_vacuum: 311.0     # Merlin-1D like
    vectors:
      thrust_direction: [0, 0, 1]    # +Z body = up
      nozzle_position: [0, 0, 0]

  # ---------------------------------------------------------------------------
  # Force Aggregator
  # ---------------------------------------------------------------------------

  - type: ForceAggregator
    name: Forces
    entity: Rocket
    sources: [Gravity, Engine]

  # ---------------------------------------------------------------------------
  # 6DOF Dynamics
  # ---------------------------------------------------------------------------

  - type: RigidBody6DOF
    name: EOM
    entity: Rocket
    vectors:
      # Testing both LLA and Euler angles
      initial_lla: [0.0, 0.0, 100000.0]     # Equator, prime meridian, 100km altitude
      initial_velocity_body: [0, 0, 0]      # Starting from rest
      initial_euler_zyx: [0.0, 90.0, 0.0]   # 90 degree pitch up (vertical)
      initial_omega_body: [0, 0, 0]         # No initial rotation

# =============================================================================
# Signal Routing
# =============================================================================
routes:
  # --- Engine inputs ---
  # Throttle command (external injection point for Hermes)
  # For standalone testing, this defaults to 0

  # Engine mass flow â†’ FuelTank
  - input: Rocket.FuelTank.mass_flow_rate
    output: Rocket.Engine.mass_flow_rate

  # --- Gravity inputs ---
  # Position from EOM
  - input: Rocket.Gravity.position.x
    output: Rocket.EOM.position.x
  - input: Rocket.Gravity.position.y
    output: Rocket.EOM.position.y
  - input: Rocket.Gravity.position.z
    output: Rocket.EOM.position.z
  # Mass from aggregator
  - input: Rocket.Gravity.mass
    output: Rocket.Mass.total_mass

  # --- ForceAggregator inputs ---
  # CG for moment transfer
  - input: Rocket.Forces.cg.x
    output: Rocket.Mass.cg.x
  - input: Rocket.Forces.cg.y
    output: Rocket.Mass.cg.y
  - input: Rocket.Forces.cg.z
    output: Rocket.Mass.cg.z

  # --- EOM inputs ---
  # Forces
  - input: Rocket.EOM.total_force.x
    output: Rocket.Forces.total_force.x
  - input: Rocket.EOM.total_force.y
    output: Rocket.Forces.total_force.y
  - input: Rocket.EOM.total_force.z
    output: Rocket.Forces.total_force.z
  # Moments
  - input: Rocket.EOM.total_moment.x
    output: Rocket.Forces.total_moment.x
  - input: Rocket.EOM.total_moment.y
    output: Rocket.Forces.total_moment.y
  - input: Rocket.EOM.total_moment.z
    output: Rocket.Forces.total_moment.z
  # Mass properties
  - input: Rocket.EOM.total_mass
    output: Rocket.Mass.total_mass
  - input: Rocket.EOM.inertia.xx
    output: Rocket.Mass.inertia.xx
  - input: Rocket.EOM.inertia.yy
    output: Rocket.Mass.inertia.yy
  - input: Rocket.EOM.inertia.zz
    output: Rocket.Mass.inertia.zz
  - input: Rocket.EOM.inertia.xy
    output: Rocket.Mass.inertia.xy
  - input: Rocket.EOM.inertia.xz
    output: Rocket.Mass.inertia.xz
  - input: Rocket.EOM.inertia.yz
    output: Rocket.Mass.inertia.yz

# =============================================================================
# Scheduler
# =============================================================================
scheduler:
  topology:
    mode: automatic
    log_order: true
  groups:
    - name: mass
      rate_hz: 100.0
      priority: 1
      members:
        - component: Structure
          priority: 1
        - component: FuelTank
          priority: 2
        - component: Mass
          priority: 3
    - name: forces
      rate_hz: 100.0
      priority: 2
      members:
        - component: Gravity
          priority: 1
        - component: Engine
          priority: 2
        - component: Forces
          priority: 3
    - name: dynamics
      rate_hz: 100.0
      priority: 3
      members:
        - component: EOM
          priority: 1

# =============================================================================
# Recording (HDF5 telemetry)
# =============================================================================
recording:
  enabled: false  # Disabled for standalone testing (enable for telemetry capture)
  file: "rocket_ascent.h5"
  decimation: 10
  signals:
    - Rocket.EOM.position.x
    - Rocket.EOM.position.y
    - Rocket.EOM.position.z
    - Rocket.EOM.velocity_body.x
    - Rocket.EOM.velocity_body.y
    - Rocket.EOM.velocity_body.z
    - Rocket.Engine.thrust
    - Rocket.Engine.mass_flow_rate
    - Rocket.FuelTank.fuel_mass
    - Rocket.Mass.total_mass

# =============================================================================
# Logging
# =============================================================================
logging:
  console_level: info
  file_level: debug
  progress:
    enabled: true
    interval: 10.0
